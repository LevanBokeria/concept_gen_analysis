---
title: "demographics_explore"
output: bookdown::html_document2
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r load-all-libraries, message=FALSE, warning=FALSE, results=FALSE}

# Clean the environment
rm(list=ls())

# Load libraries
library(tidyverse)
library(readxl)
library(ggpubr)
library(rstatix)
library(emmeans)
library(BayesFactor)
library(DT)
library(kableExtra)
library(assortedRFunctions)
library(TOSTER)

# Source other scripts
source('./utils/load_transform_gather.R')

```

# Load and get the datasets ready

```{r load-transform-gather-filter-qc, message=FALSE}

outList <- load_transform_gather()

long_form_data_all_ptp_analyzed <- 
    outList$long_form_data_all_ptp_analyzed
long_form_data_qc_pass_ptp_analyzed <- 
    outList$long_form_data_qc_pass_ptp_analyzed

results_table_all_ptp_analyzed <- 
        outList$results_table_all_ptp_analyzed
results_table_qc_pass_ptp_analyzed <- 
    outList$results_table_qc_pass_ptp_analyzed
results_table_qc_pass_ptp_analyzed_gathered <- 
    outList$results_table_qc_pass_ptp_analyzed_gathered

rm(outList)

```


# Start with the whole data, without QC pass

```{r age-sex}
# Sex
results_table_all_ptp_analyzed %>% 
        subset(data_submitted == 1 & status != 'RETURNED') %>% 
        group_by(congruency,Sex) %>%
        summarise(count = n()) %>%
        knitr::kable() %>%
        kable_styling(bootstrap_options = "striped")

# Sex
results_table_qc_pass_ptp_analyzed %>% 
        subset(data_submitted == 1 & status != 'RETURNED') %>% 
        group_by(congruency,Sex) %>%
        summarise(count = n()) %>%
        knitr::kable() %>%
        kable_styling(bootstrap_options = "striped")
# Age
results_table_all_ptp_analyzed %>% 
        subset(data_submitted == 1 & status != 'RETURNED') %>% 
        group_by(congruency) %>%
        get_summary_stats(age, show = c('mean','median','sd')) %>%
        knitr::kable() %>%
        kable_styling(bootstrap_options = "striped")

# Age
results_table_qc_pass_ptp_analyzed %>% 
        subset(data_submitted == 1 & status != 'RETURNED') %>% 
        group_by(congruency) %>%
        get_summary_stats(age, show = c('mean','median','sd')) %>%
        knitr::kable() %>%
        kable_styling(bootstrap_options = "striped")

```
```{r why-qc-fail}

results_table_all_ptp_analyzed %>% 
        subset(data_submitted == 1) %>%
        group_by(data_submitted,global_pass_incl_phase_2_fails,
                 debrief_qc_pass,fb_int_qc_pass,
                 basic_data_checks_pass,
                 phase_1_rt_qc_pass,phase_2_rt_qc_pass) %>%
        summarize(count = n()) %>%
        knitr::kable() %>%
        kable_styling(bootstrap_options = "striped")





```

